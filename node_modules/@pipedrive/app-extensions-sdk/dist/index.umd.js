!function(i,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(i="undefined"!=typeof globalThis?globalThis:i||self).AppExtensionsSDK=e()}(this,(function(){"use strict";function i(i,e,t,n){return new(t||(t=Promise))((function(o,s){function a(i){try{d(n.next(i))}catch(i){s(i)}}function r(i){try{d(n.throw(i))}catch(i){s(i)}}function d(i){var e;i.done?o(i.value):(e=i.value,e instanceof t?e:new t((function(i){i(e)}))).then(a,r)}d((n=n.apply(i,e||[])).next())}))}var e,t,n,o,s,a,r,d,c;!function(i){i.SHOW_SNACKBAR="show_snackbar",i.SHOW_CONFIRMATION="show_confirmation",i.RESIZE="resize",i.INITIALIZE="initialize",i.OPEN_MODAL="open_modal",i.CLOSE_MODAL="close_modal",i.GET_SIGNED_TOKEN="get_signed_token",i.REDIRECT_TO="redirect_to",i.SHOW_FLOATING_WINDOW="show_floating_window",i.HIDE_FLOATING_WINDOW="hide_floating_window",i.SET_NOTIFICATION="set_notification",i.SET_FOCUS_MODE="set_focus_mode"}(e||(e={})),function(i){i.VISIBILITY="visibility",i.CLOSE_CUSTOM_MODAL="close_custom_modal",i.PAGE_VISIBILITY_STATE="page_visibility_state"}(t||(t={})),function(i){i.COMMAND="command",i.LISTENER="listener",i.TRACK="track"}(n||(n={})),function(i){i.PRIMARY="primary",i.SECONDARY="secondary",i.NEGATIVE="negative"}(o||(o={})),function(i){i.DEAL="deal",i.ORGANIZATION="organization",i.PERSON="person",i.ACTIVITY="activity",i.JSON_MODAL="json_modal",i.CUSTOM_MODAL="custom_modal"}(s||(s={})),function(i){i.CLOSED="closed",i.SUBMITTED="submitted"}(a||(a={})),function(i){i.FOCUSED="focused"}(r||(r={})),function(i){i.USER="user",i.COMMAND="command"}(d||(d={})),function(i){i.DEALS="deals",i.LEADS="leads",i.ORGANIZATIONS="organizations",i.CONTACTS="contacts",i.CAMPAIGNS="campaigns",i.PROJECTS="projects",i.SETTINGS="settings"}(c||(c={}));const l=Object.values(e),u=Object.values(t);return Object.assign(class{constructor(i={}){const{identifier:e,targetWindow:t}=i;if(this.initialized=!1,this.window=null!=t?t:window.parent,this.identifier=null!=e?e:new URLSearchParams(window.location.search).get("id"),!this.identifier)throw new Error("Missing custom UI identifier");!function(i){let e=!1;null===window||void 0===window||window.addEventListener("focus",(()=>{e||i(),e=!0})),null===window||void 0===window||window.addEventListener("blur",(()=>{e=!1}))}((()=>{this.track(r.FOCUSED)}))}postMessage(i,e="*"){return new Promise(((t,n)=>{const o=new MessageChannel,s={payload:i,id:this.identifier};o.port1.onmessage=({data:i})=>{o.port1.close();const{error:e,data:s}=i;e?n(new Error(e)):t(s)},this.window.postMessage(s,e,[o.port2])}))}execute(i,...e){if(!this.initialized)throw new Error("SDK is not initialized");if(!l.includes(i))throw new Error("Invalid command");return this.postMessage({command:i,args:e[0],type:n.COMMAND})}track(i,e="*"){const t={payload:{type:n.TRACK,event:i},id:this.identifier};this.window.postMessage(t,e)}onPageVisibilityChange(i){const e=()=>{i({data:{state:document.visibilityState}})};return document.addEventListener("visibilitychange",e),()=>document.removeEventListener("visibilitychange",e)}listen(i,e){if(!u.includes(i))throw new Error("Invalid event");if(i===t.PAGE_VISIBILITY_STATE)return this.onPageVisibilityChange(e);const o=new MessageChannel,s={payload:{type:n.LISTENER,event:i},id:this.identifier};return o.port1.onmessage=({data:i})=>{i.error&&o.port1.close(),e(i)},this.window.postMessage(s,"*",[o.port2]),()=>{o.port1.close()}}setWindow(i){this.window=i}initialize(t={}){return i(this,void 0,void 0,(function*(){return yield this.postMessage({command:e.INITIALIZE,args:t,type:n.COMMAND}),this.initialized=!0,this}))}},{Command:e,Event:t,Modal:s,ModalStatus:a,Color:o,TrackingEvent:r,MessageType:n,View:c,VisibilityEventInvoker:d})}));
//# sourceMappingURL=index.umd.js.map
